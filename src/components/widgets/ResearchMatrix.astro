---
/**
 * ResearchMatrix.astro
 * Industrial Bento Grid Component
 *
 * Features:
 * - Asymmetric grid layout with varying cell sizes
 * - Grid-breaking elements and overlapping cards
 * - Technical markings and data displays
 * - Staggered reveal animations
 * - Industrial glass panels
 */
import { ScrollReveal } from '~/components/ui/cyber';
import { getPermalink } from '~/utils/permalinks';

interface MatrixCell {
	id: string;
	titleKey: string;
	descKey: string;
	icon: string;
	accent: 'acid' | 'electric' | 'orange' | 'violet';
	size: 'large' | 'medium' | 'small';
	link?: string;
	stats?: { label: string; value: string };
}

interface Props {
	title?: string;
	titleKey?: string;
	subtitle?: string;
	subtitleKey?: string;
	cells?: MatrixCell[];
	class?: string;
}

const defaultCells: MatrixCell[] = [
	{
		id: 'RES-001',
		titleKey: 'lab.matrix.problemDriven.title',
		descKey: 'lab.matrix.problemDriven.desc',
		icon: '?',
		accent: 'acid',
		size: 'large',
		link: '/curriculum',
		stats: { label: 'Projects', value: '1,247' },
	},
	{
		id: 'RES-002',
		titleKey: 'lab.matrix.crossDisciplinary.title',
		descKey: 'lab.matrix.crossDisciplinary.desc',
		icon: '+',
		accent: 'electric',
		size: 'medium',
		link: '/challenges',
		stats: { label: 'Fields', value: '12' },
	},
	{
		id: 'RES-003',
		titleKey: 'lab.matrix.handsOn.title',
		descKey: 'lab.matrix.handsOn.desc',
		icon: '*',
		accent: 'orange',
		size: 'medium',
		link: '/activities',
	},
	{
		id: 'RES-004',
		titleKey: 'lab.matrix.innovation.title',
		descKey: 'lab.matrix.innovation.desc',
		icon: '~',
		accent: 'violet',
		size: 'small',
		link: '/spaces',
	},
	{
		id: 'RES-005',
		titleKey: 'lab.matrix.community.title',
		descKey: 'lab.matrix.community.desc',
		icon: '@',
		accent: 'acid',
		size: 'small',
		link: '/about',
		stats: { label: 'Members', value: '50+' },
	},
];

const {
	titleKey = 'lab.matrix.sectionTitle',
	subtitleKey = 'lab.matrix.sectionSubtitle',
	cells = defaultCells,
	class: className = '',
} = Astro.props;

// Color mappings
const accentColors = {
	acid: {
		text: 'text-signal-acid',
		bg: 'bg-signal-acid',
		border: 'border-signal-acid/30',
		glow: 'shadow-lab-acid',
		gradient: 'from-signal-acid/20 to-transparent',
	},
	electric: {
		text: 'text-signal-electric',
		bg: 'bg-signal-electric',
		border: 'border-signal-electric/30',
		glow: 'shadow-lab-electric',
		gradient: 'from-signal-electric/20 to-transparent',
	},
	orange: {
		text: 'text-signal-orange',
		bg: 'bg-signal-orange',
		border: 'border-signal-orange/30',
		glow: 'shadow-lab-orange',
		gradient: 'from-signal-orange/20 to-transparent',
	},
	violet: {
		text: 'text-signal-violet',
		bg: 'bg-signal-violet',
		border: 'border-signal-violet/30',
		glow: 'shadow-[0_0_20px_rgba(139,92,246,0.3)]',
		gradient: 'from-signal-violet/20 to-transparent',
	},
};
---

<section class={`relative py-24 lg:py-32 overflow-hidden ${className}`}>
	<!-- Background Elements -->
	<div class="absolute inset-0 pointer-events-none">
		<!-- Crosshair pattern -->
		<div class="absolute inset-0 opacity-20" style="background: linear-gradient(rgba(212, 255, 0, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(212, 255, 0, 0.05) 1px, transparent 1px); background-size: 80px 80px;"></div>

		<!-- Accent glow -->
		<div class="absolute top-0 left-1/2 -translate-x-1/2 w-[80vw] h-[50vh] bg-signal-acid/3 rounded-full filter blur-[200px]"></div>
	</div>

	<div class="relative z-10 max-w-[90rem] mx-auto px-6 sm:px-8 lg:px-12">
		<!-- ========================================
		     SECTION HEADER
		     ======================================== -->
		<ScrollReveal client:visible variant="slide-up" delay={0}>
			<div class="mb-16 lg:mb-20">
				<!-- Technical Label -->
				<div class="flex items-center gap-4 mb-6">
					<div class="w-12 h-[1px] bg-signal-acid"></div>
					<span class="font-data text-xs text-signal-acid tracking-[0.3em]">RESEARCH_MATRIX</span>
				</div>

				<!-- Title -->
				<h2 class="font-lab text-4xl sm:text-5xl lg:text-6xl font-bold text-lab-text leading-tight tracking-tight mb-4">
					<span data-i18n={titleKey}>Core Research Areas</span>
				</h2>

				<!-- Subtitle -->
				<p class="max-w-2xl text-lg text-lab-muted">
					<span data-i18n={subtitleKey}>Explore our interdisciplinary approach to learning and discovery</span>
				</p>
			</div>
		</ScrollReveal>

		<!-- ========================================
		     BENTO GRID
		     ======================================== -->
		<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-12 gap-4 lg:gap-6 auto-rows-[minmax(180px,auto)]">

			{cells.map((cell, index) => {
				const colors = accentColors[cell.accent];
				const delay = 0.1 + (index * 0.1);

				// Determine grid span based on size
				const gridClass = cell.size === 'large'
					? 'lg:col-span-7 lg:row-span-2'
					: cell.size === 'medium'
						? 'lg:col-span-5'
						: 'lg:col-span-6';

				return (
					<ScrollReveal client:visible variant="slide-up" delay={delay}>
						<a
							href={cell.link ? getPermalink(cell.link) : '#'}
							class={`group relative block h-full min-h-[200px] ${gridClass}`}
						>
							{/* Main Card */}
							<div class={`
								relative h-full lab-glass overflow-hidden
								transition-all duration-500 ease-out
								hover:border-${cell.accent === 'acid' ? 'signal-acid/50' : cell.accent === 'electric' ? 'signal-electric/50' : cell.accent === 'orange' ? 'signal-orange/50' : 'signal-violet/50'}
								group-hover:shadow-lg
							`}>
								{/* Gradient Overlay */}
								<div class={`absolute inset-0 bg-gradient-to-br ${colors.gradient} opacity-0 group-hover:opacity-100 transition-opacity duration-500`}></div>

								{/* Content */}
								<div class="relative z-10 h-full p-6 lg:p-8 flex flex-col">
									{/* Header */}
									<div class="flex items-start justify-between mb-6">
										{/* Icon Box */}
										<div class={`
											w-14 h-14 flex items-center justify-center
											bg-lab-graphite border ${colors.border}
											font-lab text-2xl font-bold ${colors.text}
											transition-all duration-300
											group-hover:scale-110 group-hover:${colors.glow}
										`}>
											{cell.icon}
										</div>

										{/* ID Badge */}
										<div class="font-data text-xs text-lab-dim tracking-wider">
											{cell.id}
										</div>
									</div>

									{/* Title & Description */}
									<div class="flex-1">
										<h3 class={`font-lab text-xl lg:text-2xl font-semibold text-lab-text mb-3 transition-colors duration-300 group-hover:${colors.text}`}>
											<span data-i18n={cell.titleKey}>{cell.titleKey.split('.').pop()}</span>
										</h3>
										<p class="text-lab-muted text-sm leading-relaxed">
											<span data-i18n={cell.descKey}>Description placeholder</span>
										</p>
									</div>

									{/* Footer */}
									<div class="mt-6 pt-4 border-t border-lab-steel/30 flex items-center justify-between">
										{cell.stats ? (
											<div class="font-data text-xs">
												<span class="text-lab-dim">{cell.stats.label}</span>
												<span class={`ml-2 ${colors.text}`}>{cell.stats.value}</span>
											</div>
										) : (
											<div class="font-data text-xs text-lab-dim">EXPLORE</div>
										)}

										{/* Arrow */}
										<div class={`w-8 h-8 flex items-center justify-center border ${colors.border} rounded-full opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-x-2 group-hover:translate-x-0`}>
											<svg class={`w-4 h-4 ${colors.text}`} fill="none" viewBox="0 0 24 24" stroke="currentColor">
												<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
											</svg>
										</div>
									</div>
								</div>

								{/* Hover Accent Line */}
								<div class={`absolute bottom-0 left-0 right-0 h-[2px] ${colors.bg} transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500 origin-left`}></div>
							</div>

							{/* Grid Break Element - only on large cards */}
							{cell.size === 'large' && (
								<div class="absolute -top-3 -right-3 w-20 h-20 border border-lab-steel/20 rotate-12 opacity-30 hidden lg:block"></div>
							)}
						</a>
					</ScrollReveal>
				);
			})}

		</div>

		<!-- ========================================
		     DECORATIVE ELEMENTS
		     ======================================== -->
		<!-- Overlapping technical element -->
		<div class="hidden lg:block absolute right-12 top-[40%] pointer-events-none">
			<div class="relative">
				<div class="w-32 h-32 border border-lab-steel/20 rotate-45"></div>
				<div class="absolute inset-4 border border-lab-steel/10 rotate-45"></div>
				<div class="absolute inset-0 flex items-center justify-center font-data text-[10px] text-lab-dim tracking-widest -rotate-45">
					GRID.REF
				</div>
			</div>
		</div>

		<!-- Data stream line -->
		<div class="absolute left-8 top-[30%] bottom-[30%] w-[1px] bg-gradient-to-b from-transparent via-lab-steel/20 to-transparent hidden lg:block">
			<div class="absolute top-0 left-0 w-full h-8 bg-signal-acid/30 animate-lab-data-stream"></div>
		</div>

	</div>
</section>

<style>
	/* Matrix-specific hover effects */
	.group:hover .lab-glass {
		background: rgba(26, 26, 33, 0.85);
	}

	/* Ensure proper accent border colors on hover */
	.group:hover [class*="border-signal-acid"] {
		border-color: rgba(212, 255, 0, 0.5);
	}
	.group:hover [class*="border-signal-electric"] {
		border-color: rgba(0, 212, 255, 0.5);
	}
	.group:hover [class*="border-signal-orange"] {
		border-color: rgba(255, 107, 0, 0.5);
	}
	.group:hover [class*="border-signal-violet"] {
		border-color: rgba(139, 92, 246, 0.5);
	}
</style>
