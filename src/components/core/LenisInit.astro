---
/**
 * Lenis Smooth Scrolling Component
 * Initializes Lenis for butter-smooth scrolling experience
 */
---

<!-- Lenis CSS -->
<style is:global>
  /* Lenis base styles */
  html.lenis, html.lenis body {
    height: auto;
  }

  .lenis.lenis-smooth {
    scroll-behavior: auto !important;
  }

  .lenis.lenis-smooth [data-lenis-prevent] {
    overscroll-behavior: contain;
  }

  .lenis.lenis-stopped {
    overflow: hidden;
  }

  .lenis.lenis-smooth iframe {
    pointer-events: none;
  }

  /* Scroll-based effects */
  body.is-scrolling {
    /* Elements can react to scrolling state */
  }

  body.is-scrolling-fast {
    /* Fast scroll effects */
  }

  /* Smooth scroll anchor offset for fixed header */
  :target {
    scroll-margin-top: 80px;
  }

  /* Scroll-linked animations */
  @supports (animation-timeline: scroll()) {
    /* Progress bar at top of page */
    .scroll-progress {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: linear-gradient(90deg,
        var(--color-primary, #6366f1) 0%,
        var(--color-secondary, #a855f7) 100%
      );
      transform-origin: left;
      transform: scaleX(0);
      animation: scroll-progress-anim linear;
      animation-timeline: scroll();
      z-index: 9999;
    }

    @keyframes scroll-progress-anim {
      to {
        transform: scaleX(1);
      }
    }
  }

  /* Scroll reveal animations */
  .scroll-fade-in {
    opacity: 0;
    transform: translateY(30px);
    transition: opacity 0.6s ease-out, transform 0.6s ease-out;
  }

  .scroll-fade-in.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .scroll-slide-left {
    opacity: 0;
    transform: translateX(-50px);
    transition: opacity 0.6s ease-out, transform 0.6s ease-out;
  }

  .scroll-slide-left.is-visible {
    opacity: 1;
    transform: translateX(0);
  }

  .scroll-slide-right {
    opacity: 0;
    transform: translateX(50px);
    transition: opacity 0.6s ease-out, transform 0.6s ease-out;
  }

  .scroll-slide-right.is-visible {
    opacity: 1;
    transform: translateX(0);
  }

  .scroll-scale-in {
    opacity: 0;
    transform: scale(0.9);
    transition: opacity 0.6s ease-out, transform 0.6s ease-out;
  }

  .scroll-scale-in.is-visible {
    opacity: 1;
    transform: scale(1);
  }

  /* Parallax effect helper classes */
  .parallax-slow {
    will-change: transform;
  }

  .parallax-fast {
    will-change: transform;
  }

  /* Stagger animation delays */
  .stagger-1 { transition-delay: 0.1s; }
  .stagger-2 { transition-delay: 0.2s; }
  .stagger-3 { transition-delay: 0.3s; }
  .stagger-4 { transition-delay: 0.4s; }
  .stagger-5 { transition-delay: 0.5s; }
  .stagger-6 { transition-delay: 0.6s; }
</style>

<!-- Lenis initialization script -->
<script>
  import '~/scripts/lenis-init.ts';

  // Intersection Observer for scroll reveal animations
  const setupScrollReveal = () => {
    const observerOptions = {
      root: null,
      rootMargin: '0px 0px -50px 0px',
      threshold: 0.1,
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');
        }
      });
    }, observerOptions);

    // Observe all scroll-animated elements
    document.querySelectorAll('.scroll-fade-in, .scroll-slide-left, .scroll-slide-right, .scroll-scale-in').forEach((el) => {
      observer.observe(el);
    });
  };

  // Initialize on page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', setupScrollReveal);
  } else {
    setupScrollReveal();
  }

  // Re-initialize on Astro page navigation
  document.addEventListener('astro:page-load', setupScrollReveal);
</script>
