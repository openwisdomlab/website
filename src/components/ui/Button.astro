---
/**
 * Button - 赛博朋克风格按钮组件
 * 特点：故障效果（Glitch）、流光边框、霓虹发光
 */
interface Props {
	variant?: 'neon' | 'ghost' | 'outline' | 'brutal';
	size?: 'sm' | 'md' | 'lg' | 'xl';
	glow?: boolean;
	glitch?: boolean;
	href?: string;
	type?: 'button' | 'submit' | 'reset';
	className?: string;
}

const {
	variant = 'neon',
	size = 'md',
	glow = true,
	glitch = false,
	href,
	type = 'button',
	className = '',
} = Astro.props;

const Tag = href ? 'a' : 'button';

// 尺寸样式
const sizeClasses = {
	sm: 'px-4 py-2 text-sm',
	md: 'px-6 py-3 text-base',
	lg: 'px-8 py-4 text-lg',
	xl: 'px-10 py-5 text-xl',
};

// 变体样式
const variantClasses = {
	neon: 'bg-gradient-neon text-white font-bold',
	ghost: 'bg-transparent text-white border-2 border-white/20 hover:border-primary-400 hover:bg-white/5',
	outline: 'bg-transparent text-primary-400 border-2 border-primary-400 hover:bg-primary-400 hover:text-white',
	brutal: 'bg-primary-500 text-white font-black border-3 border-black',
};

// 发光效果
const glowClass = glow ? {
	neon: 'shadow-neon hover:shadow-neon-lg',
	ghost: 'hover:shadow-glow',
	outline: 'hover:shadow-glow',
	brutal: 'shadow-brutal hover:shadow-brutal-sm',
}[variant] : '';
---

<Tag
	href={href}
	type={!href ? type : undefined}
	class={`
		group relative inline-flex items-center justify-center
		rounded-lg
		font-semibold
		transition-all duration-300
		transform hover:scale-105
		overflow-hidden
		${sizeClasses[size]}
		${variantClasses[variant]}
		${glowClass}
		${glitch ? 'hover:animate-glitch' : ''}
		${className}
	`}
>
	<!-- 流光效果 -->
	{variant === 'neon' && (
		<div class="absolute inset-0 bg-gradient-holographic bg-[length:200%_200%] animate-border-flow opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
	)}

	<!-- Brutal 阴影 -->
	{variant === 'brutal' && (
		<div class="absolute -bottom-1 -right-1 w-full h-full bg-black -z-10 rounded-lg group-hover:-bottom-0.5 group-hover:-right-0.5 transition-all"></div>
	)}

	<!-- 内容 -->
	<span class="relative z-10 flex items-center gap-2">
		<slot />
	</span>

	<!-- 悬停时的脉冲效果 -->
	{glow && (
		<div class="absolute inset-0 rounded-lg bg-white/10 opacity-0 group-hover:opacity-100 group-hover:animate-ping transition-opacity"></div>
	)}
</Tag>

<style>
	/* 故障效果增强 */
	.group:hover.hover\:animate-glitch::before,
	.group:hover.hover\:animate-glitch::after {
		content: attr(data-text);
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: inherit;
	}

	.group:hover.hover\:animate-glitch::before {
		left: 2px;
		text-shadow: -2px 0 #ff00de;
		clip: rect(24px, 550px, 90px, 0);
		animation: glitch-anim-2 3s infinite linear alternate-reverse;
	}

	.group:hover.hover\:animate-glitch::after {
		left: -2px;
		text-shadow: -2px 0 #00fff9, 2px 2px #ff00de;
		clip: rect(85px, 550px, 140px, 0);
		animation: glitch-anim 2.5s infinite linear alternate-reverse;
	}

	@keyframes glitch-anim {
		0% {
			clip: rect(17px, 9999px, 94px, 0);
		}
		20% {
			clip: rect(73px, 9999px, 28px, 0);
		}
		40% {
			clip: rect(31px, 9999px, 40px, 0);
		}
		60% {
			clip: rect(98px, 9999px, 15px, 0);
		}
		80% {
			clip: rect(65px, 9999px, 82px, 0);
		}
		100% {
			clip: rect(46px, 9999px, 99px, 0);
		}
	}

	@keyframes glitch-anim-2 {
		0% {
			clip: rect(65px, 9999px, 119px, 0);
		}
		20% {
			clip: rect(52px, 9999px, 74px, 0);
		}
		40% {
			clip: rect(79px, 9999px, 85px, 0);
		}
		60% {
			clip: rect(106px, 9999px, 122px, 0);
		}
		80% {
			clip: rect(20px, 9999px, 40px, 0);
		}
		100% {
			clip: rect(93px, 9999px, 60px, 0);
		}
	}
</style>
